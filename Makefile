all: chal

payload.so: payload.c
	gcc -g -fPIC --shared -o payload.so payload.c

clean:
	rm -rf *.o *.so payload caller foo timecaller freemoney .s chal payload.zip xor

payload.zip: payload.so
	cp payload.so .s
	zip payload.zip .s
	rm .s

freemoney: freemoney.c
	gcc -o freemoney --static -O2 freemoney.c
	strip freemoney

chal: freemoney payload.zip xor
	cat freemoney payload.zip > chal
	chmod a+x chal
